# n8n-notion-media-library-pitfalls
# 【實作筆記】3 小時的血淚：為何用 n8n 串接 Notion 圖文庫比想像中困難？

在建構個人知識庫助理時，我想要達成以下情境：
> **「把 Notion 當成資料庫，在 Discord 用自然語言問問題，讓 AI 讀完筆記裡的文字與圖片後直接回答。」**

### 流程設計
`Discord 觸發` → `Notion 抓取` → `AI 處理` → `Discord 回傳`

但在實際用 n8n 實踐時，我發現「文字」與「圖片」在 API 世界裡是兩個平行時空。以下是這次實作中，關於「Notion 私有圖文讀取」的血淚心得：

---

## ▍ 1. 直覺與現實的落差：菜單（URL）不等於餐點（圖片） 

身為人類，我已經習慣瀏覽器渲染後的視覺效果。看到圖片，直覺認為 API 也會直接傳回那張圖。

**但事實是：API 傳回的是「連結」，而不是「檔案」。**

當呼叫 Notion API 時，它給的是指向 AWS S3 的 **Signed URL（簽署連結）**。
* **比喻：** Notion 給我的是一張「菜單」，而不是「漢堡」。
* **困境：** 現在的 LLM（如 Gemini 1.5 或 GPT-4o）沒辦法自己拿著這張有時效限制的菜單去取餐。因此在自動化流程中，開發者需要手動扮演「瀏覽器」的角色去下載圖片。

---

## ▍ 2. n8n 實作中的兩大技術痛點 

我原本預期 3 到 4 個節點就能搞定，最後發現需要擴展成 6-8 個節點的複雜邏輯：

### A. 二進位轉碼的「搬運工」任務 (Binary to Base64)
因為 Notion 連結會過期，我不能直接丟 URL 給 AI。標準流程變得超瑣碎：
1.  **HTTP Request**：對連結發起 GET，把圖片抓進 n8n 記憶體。
2.  **Encoding**：將二進位資料（Binary）轉為 Base64 字串。
3.  **JSON Construction**：把字串塞進 AI 規定的 JSON 結構裡。
這代表 n8n 不只要傳指令，還得承擔檔案轉碼的運算壓力。

### B. 破碎化的資料結構 (Block Parsing)
Notion 的資料是以 **Block** 為單位。一段有圖有文的筆記，在 API 眼中是被切碎的陣列。我必須寫 **Code Node (JavaScript)** 來：
* 遍歷所有 Block 並重組上下文。
* 偵測 Image Block 並精確提取 URL。
* 維持文字與圖片的關聯性，否則 AI 會「看錯圖」。

---

## ▍ 3. 為什麼不直接用 RAG 工具？ 

因為目前的 RAG（檢索增強生成）技術大多是「**文盲**」。

多數知識庫系統在匯入檔案時，會進行 OCR 或提取文字，但往往會自動忽略圖片內容。除非使用像 **Google NotebookLM** 這種原生支援長文本多模態（Long Context Multimodal）的工具，否則圖片在進入知識庫的那一刻，就經常被丟棄了。

但偏偏 NotebookLM 目前還沒有 API，無法整合進 Discord 工作流。

---

## ▍ 4. 三種架構的權衡 (Trade-offs) 

| 路徑 | 優點 | 代價 |
| :--- | :--- | :--- |
| **A. n8n + Gemini API** | 高隱私、高控制，資料完全私有。 | 開發難度最高，需處理轉碼與時效性邏輯。 |
| **B. Coze / Dify** | 低門檻、使用封裝好的插件。 | 黑盒子作業。若插件不支援讀圖，無法介入修正。 |
| **C. Publish to Web** | 難度最低，搭配 Jina Reader 轉 Markdown。 | **完全喪失隱私**。資料庫必須對全網公開。 |

---

## 結論

雖然 AI 的「大腦」已經具備強大的視覺理解力，但「資料傳輸」的基礎建設（API、權限、格式）還沒完全跟上。

把「網址」變成「AI 能理解的訊號」，中間需要大量的**工程膠水（Engineering Glue）**。如果你在意隱私與功能完整性，目前用 n8n 進行底層轉碼，雖然繁瑣，但仍是較好的解法。然而，目前 NotebookLM 是閱讀 PDF 格式圖文的最佳應用，如果哪天 NotebookLM 開放串接 API ，也許事情會更簡單。

  
*但我身為一個麻瓜，決定現在先放棄挑戰。*
